<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Carrito - Phoenix Store</title>
    <link href="/css/styles.css" rel="stylesheet">
</head>
<body>

<header>
    <div class="header-left">Phoenix Store</div>
    <div class="search-container">
        <form id="busquedaForm">
            <label for="queryInput"></label>
            <input id="queryInput" name="query" placeholder="Buscar productos..." type="text">
            <button type="submit">Buscar</button>
        </form>
    </div>
    <div class="header-right">
        <button onclick="window.location.href='/home'">Seguir comprando</button>
    </div>
</header>

<main style="width: 80%; margin-top: 30px;">
    <h2>Carrito de Compras</h2>

    <div th:if="${carrito == null or #lists.isEmpty(carrito)}">
        <p>Tu carrito está vacío.</p>
    </div>

    <table style="width: 100%; border-collapse: collapse;" th:if="${carrito != null and !#lists.isEmpty(carrito)}">
        <thead>
        <tr style="background-color: #ff6600; color: white;">
            <th style="padding: 10px;">Producto</th>
            <th style="padding: 10px;">Precio</th>
            <th style="padding: 10px;">Cantidad</th>
            <th style="padding: 10px;">Subtotal</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${carrito}">
            <td style="padding: 10px;" th:text="${item.nombre}"></td>
            <td class="precio" style="padding: 10px;" th:text="${#numbers.formatDecimal(item.precio, 0, 'NONE', 0, 'NONE')}"></td>
            <td style="padding: 10px;" th:text="${item.cantidad}"></td>
            <td class="precio" style="padding: 10px;" th:text="${#numbers.formatDecimal(item.precio * item.cantidad, 0, 'NONE', 0, 'NONE')}"></td>
        </tr>
        </tbody>
    </table>

    <div style="text-align: right; margin-top: 20px;" th:if="${carrito != null and !#lists.isEmpty(carrito)}">
        <h3>Total: $<span class="precio" th:text="${#numbers.formatDecimal(total, 0, 'NONE', 0, 'NONE')}"></span></h3>
        <form method="get" th:action="@{/orden/confirmar}">
            <button style="background-color: #ff6600; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Finalizar compra
            </button>
        </form>
    </div>
</main>

<script>
    document.getElementById('busquedaForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const query = document.getElementById('queryInput').value;
        if (query.trim() !== '') {
            window.location.href = '/home?query=' + encodeURIComponent(query);
        }
    });

    document.querySelectorAll('.precio').forEach(function(span) {
        let num = Number(span.textContent.replace(/\D/g, ''));
        if (!isNaN(num)) {
            let partes = num.toLocaleString('de-DE').split('.');
            if (partes.length > 2) {
                let millones = partes.slice(0, partes.length - 2).join('') + "'";
                let miles = partes.slice(-2).join('.');
                span.textContent = millones + miles;
            } else {
                span.textContent = partes.join('.');
            }
        }
    });
</script>
</body>
</html>